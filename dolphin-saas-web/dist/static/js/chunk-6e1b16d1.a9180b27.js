(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-6e1b16d1"],{"1bb3":function(t,e,s){},2348:function(t,e,s){},3157:function(t,e,s){},"39f8":function(t,e,s){"use strict";s.r(e);var a=s("5530"),r=(s("d3b7"),s("365c")),n=s("3d73"),i=(s("ddb0"),function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("a-form",{ref:"form",attrs:{form:t.form,layout:"vertical"}},[s("a-form-item",{attrs:{label:"部署厂商"}},[s("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["cloudId",{rules:[{required:!0,message:"资源归属不可为空!"}]}],expression:"['cloudId', { rules: [{ required: true, message: '资源归属不可为空!' }] },]"}],attrs:{placeholder:"请选择资源归属"},on:{change:t.cloudChange}},t._l(t.cloudList,(function(e){return s("a-select-option",{key:e.value},[t._v(t._s(e.label))])})),1)],1),s("a-form-item",{attrs:{label:"部署区域"}},[s("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["regionId",{rules:[{required:!0,message:"部署区域不可为空!"}]}],expression:"['regionId', { rules: [{ required: true, message: '部署区域不可为空!' }] },]"}],attrs:{placeholder:"请选择资源区域"},on:{change:t.regionChange}},t._l(t.regionList,(function(e){return s("a-select-option",{key:e.value},[t._v(t._s(e.label))])})),1)],1),s("a-form-item",{attrs:{label:"可用区域"}},[s("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["zoneId",{rules:[{required:!0,message:"可用区域不可为空!"}]}],expression:"['zoneId', { rules: [{ required: true, message: '可用区域不可为空!' }] },]"}],attrs:{placeholder:"请选择可用区域"}},t._l(t.zoneList,(function(e){return s("a-select-option",{key:e.value},[t._v(t._s(e.label))])})),1)],1),s("a-form-item",{attrs:{label:"业务并发数"}},[s("a-row",{staticClass:"amount-list",attrs:{gutter:20}},[s("a-col",{staticClass:"mb10",attrs:{span:8}},[s("a-card",{staticClass:"amount-item",class:1==t.amountType?"active-item":"",on:{click:function(e){return t.selectAmount(1,100)}}},[s("div",{staticClass:"amount-item-type"},[t._v("小型业务")]),s("div",{staticClass:"amount-item-title"},[t._v("电商型")]),s("div",{staticClass:"amount-item-text"},[s("span",{staticClass:"amount-item-label"},[t._v("同时在线:")]),s("span",{staticClass:"amount-item-label1"},[t._v("100人")])]),s("div",{staticClass:"amount-item-text"},[s("span",{staticClass:"amount-item-label"},[t._v("并发数:")]),s("span",{staticClass:"amount-item-label1"},[t._v("100")])])])],1),s("a-col",{staticClass:"mb10",attrs:{span:8}},[s("a-card",{staticClass:"amount-item",class:2==t.amountType?"active-item":"",on:{click:function(e){return t.selectAmount(2,500)}}},[s("div",{staticClass:"amount-item-type medium"},[t._v("中型业务")]),s("div",{staticClass:"amount-item-title"},[t._v("医疗型")]),s("div",{staticClass:"amount-item-text"},[s("span",{staticClass:"amount-item-label"},[t._v("同时在线:")]),s("span",{staticClass:"amount-item-label1"},[t._v("500人")])]),s("div",{staticClass:"amount-item-text"},[s("span",{staticClass:"amount-item-label"},[t._v("并发数:")]),s("span",{staticClass:"amount-item-label1"},[t._v("500")])])])],1),s("a-col",{staticClass:"mb10",attrs:{span:8}},[s("a-card",{staticClass:"amount-item",class:3==t.amountType?"active-item":"",on:{click:function(e){return t.selectAmount(3,900)}}},[s("div",{staticClass:"amount-item-type large"},[t._v("大型业务")]),s("div",{staticClass:"amount-item-title"},[t._v("科技型")]),s("div",{staticClass:"amount-item-text"},[s("span",{staticClass:"amount-item-label"},[t._v("同时在线:")]),s("span",{staticClass:"amount-item-label1"},[t._v("900人")])]),s("div",{staticClass:"amount-item-text"},[s("span",{staticClass:"amount-item-label"},[t._v("并发数:")]),s("span",{staticClass:"amount-item-label1"},[t._v("900")])])])],1),s("a-col",{staticClass:"amount-hint",attrs:{span:24}},[t._v("上面套餐内并发数只做推荐参考使用，具体并发数以实际为准，可手动调整下面进度条选择您实际并发数！")])],1),s("a-slider",{directives:[{name:"decorator",rawName:"v-decorator",value:["current",{rules:[{required:!0,message:"业务规模不可为空!"}],initialValue:1}],expression:"['current',{ rules: [{ required: true, message: '业务规模不可为空!' }],initialValue:1 }]"}],staticStyle:{width:"90%"},attrs:{marks:{1:"1",50:"50",100:"100",200:"200",300:"300",500:"500",900:"900及以上"},step:null,max:1e3,min:1}})],1),s("a-form-item",{attrs:{label:"集群类型"}},[s("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["clusterType",{rules:[{required:!0,message:"集群类型不能为空!"}]}],expression:"['clusterType',{ rules: [{ required: true, message: '集群类型不能为空!' }] },]"}]},[s("a-radio",{attrs:{value:"0"}},[t._v("按需使用")]),s("a-radio",{attrs:{value:"1"}},[t._v("月付使用")])],1)],1),s("a-form-item",{attrs:{label:"套餐类型"}},[s("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["payMode",{rules:[{required:!0,message:"套餐类型不能为空!"}]}],expression:"['payMode',{ rules: [{ required: true, message: '套餐类型不能为空!' }] },]"}]},[s("a-radio",{attrs:{value:"1"}},[t._v("基础版")]),s("a-radio",{attrs:{value:"2"}},[t._v("高级版")])],1)],1),s("a-form-item",{attrs:{wrapperCol:{span:16,offset:8}}},[s("a-button",{staticStyle:{width:"200px"},attrs:{loading:t.loading,type:"primary"},nativeOn:{click:function(e){return e.preventDefault(),t.nextStep.apply(null,arguments)}}},[t.loading?s("span",[t._v("计算中...")]):s("span",[t._v("下一步")])])],1)],1),s("a-divider"),s("a-alert",{staticClass:"mb18 step-form-style-desc",attrs:{type:"warning",description:"这里的配置一定要准确，不然可能会导致无法部署成功，影响后续的资源配置。","show-icon":"",closable:!1}})],1)}),o={props:{cloudList:{type:Array,default:!0}},data:function(){return{form:this.$form.createForm(this),regionList:[],zoneList:[],amountType:0,loading:!1}},methods:{cloudChange:function(){this.$nextTick((function(){var t=this;Object(r.v)({cloudId:this.form.getFieldsValue().cloudId}).then((function(e){var s=e.status,a=e.data,r=e.msg;1===s?(t.regionList=a||[],t.zoneList=[],t.form.setFieldsValue({regionId:void 0,zoneId:void 0})):t.$message.error(r)})).catch((function(){}))}))},regionChange:function(){this.$nextTick((function(){var t=this;Object(r.u)({cloudId:this.form.getFieldsValue().cloudId,regionId:this.form.getFieldsValue().regionId}).then((function(e){var s=e.status,a=e.data,r=e.msg;1===s?(t.zoneList=a||[],t.form.setFieldsValue({zoneId:void 0})):t.$message.error(r)})).catch((function(){}))}))},selectAmount:function(t,e){this.$nextTick((function(){this.amountType=t,this.form.setFieldsValue({current:e})}))},nextStep:function(){var t=this;this.loading=!0;(0,this.form.validateFields)(["cloudId","regionId","zoneId","current","clusterType","payMode"],{force:!0},(function(e,s){if(e)return t.loading=!1,!1;s=Object(a.a)({},s),Object(r.f)(Object(a.a)({},s)).then((function(e){var a=e.status,r=e.data,n=e.msg;1===a?t.$emit("nextStep",{values:s,data:r}):t.$message.error(n)})).catch((function(e){t.$message.error(e)})).finally((function(){t.loading=!1}))}))}}},c=o,l=(s("81e91"),s("2877")),u=Object(l.a)(c,i,[],!1,null,"30c5090a",null).exports,d=s("432b"),p=[{title:"资源名称",className:"mw90",dataIndex:"spec",scopedSlots:{customRender:"spec"}},{title:"资源规格",className:"mw120",dataIndex:"cvm",scopedSlots:{customRender:"cvm"}},{title:"资源单价",className:"mw90",dataIndex:"price",scopedSlots:{customRender:"price"}},{title:"资源数量",className:"mw90",scopedSlots:{customRender:"assetNumber"}},{title:"资源备注",dataIndex:"remark",scopedSlots:{customRender:"remark"}}],m=[{title:"类目",className:"mw90",dataIndex:"typeName",scopedSlots:{customRender:"typeName"}},{title:"单价",className:"mw120",dataIndex:"orderPrice",scopedSlots:{customRender:"orderPrice"}},{title:"备注",className:"mw90",dataIndex:"orderInfo",scopedSlots:{customRender:"orderInfo"}}],f={0:{status:"processing",text:"初始化(搭建)"},1:{status:"processing",text:"待决策"},2:{status:"processing",text:"配置部署中"},3:{status:"success",text:"运行中"},4:{status:"error",text:"异常"},5:{status:"default",text:"停用"},6:{status:"warning",text:"回收中"}},v={mixins:[d.a],props:{form:{type:Object,required:!0},assetData:{type:Object,required:!0}},filters:{statusFilter:function(t){return f[t].text},statusTypeFilter:function(t){return f[t].status}},data:function(){return{columns:p,columns1:m,sourceId:0,loading:!1}},methods:{nextStep:function(){var t=this;this.loading=!0,Object(r.g)(Object(a.a)(Object(a.a)({},this.form),{sourceId:this.sourceId})).then((function(e){var s=e.status,a=e.data,r=e.msg;1===s?t.$emit("nextStep",a):t.$message.error(r)})).catch((function(e){t.$message.error(e)})).finally((function(){t.loading=!1}))},prevStep:function(){this.$emit("prevStep")}}},h=v,g=(s("9aa5"),Object(l.a)(h,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("a-alert",{staticClass:"mb18",attrs:{title:"配置提醒",type:"warning",description:"请确认配置信息准确，不然可能会导致无法部署成功，影响后续的资源配置。确认后，您配置的信息将开始创建并部署，并且进行扣费，无法退回。","show-icon":"",closable:!1}}),s("a-divider",{attrs:{orientation:"left"}},[t._v("基础信息")]),s("a-descriptions",{attrs:{size:"small",column:t.isMobile?1:3,layout:"vertical",bordered:""}},[s("a-descriptions-item",{attrs:{label:"归属云"}},[t._v(t._s(t.assetData.cloud||"无"))]),s("a-descriptions-item",{staticClass:"text-red font-bold",attrs:{label:"总价格"}},[t._v(t._s((Math.ceil(100*+t.assetData.totalPrice)/100).toFixed(2)||"无"))]),s("a-descriptions-item",{attrs:{label:"并发数"}},[t._v(t._s(t.assetData.current||"无"))]),s("a-descriptions-item",{attrs:{label:"创建时间"}},[t._v(t._s(t.assetData.creatatime||"无"))])],1),s("a-divider",{attrs:{orientation:"left"}},[t._v("资源清单")]),s("a-table",{ref:"table",attrs:{size:"middle",columns:t.columns,dataSource:[{spec:t.assetData.cfs.spec,price:t.assetData.cfs.price,remark:t.assetData.cfs.remark,type:"cfs"},{spec:"TCR",cvm:t.assetData.tcr.spec,price:t.assetData.tcr.price,remark:t.assetData.tcr.remark,type:"tcr"},{spec:t.assetData.network.spec,price:t.assetData.network.price,remark:t.assetData.network.remark,type:"network"}].concat(t.assetData.cvmLists),pagination:!1,rowKey:function(t,e){return e}},scopedSlots:t._u([{key:"spec",fn:function(e,a){var r=a.type;return s("span",{},[s("span",r?[t._v(t._s(e))]:[t._v("云服务器")])])}},{key:"cvm",fn:function(e){return s("span",{},[t._v(t._s(e||"无"))])}},{key:"price",fn:function(e,a){var r=a.type;return s("span",{},[s("span","cfs"==r||"tcr"==r?[t._v(t._s((Math.ceil(100*+e)/100).toFixed(2)+"元"||!1))]:"network"==r?[t._v(t._s((Math.ceil(100*+e)/100).toFixed(2)+"/元"||!1))]:[t._v(t._s((Math.ceil(100*+e)/100).toFixed(2))+"元/小时")])])}},{key:"assetNumber",fn:function(e){var a=e.type;return s("span",{},[s("span",a?[t._v("N")]:[t._v("1/台")])])}},{key:"remark",fn:function(e){return s("span",{},[t._v(t._s(e||"无"))])}}])}),s("a-divider",{attrs:{orientation:"left"}},[t._v("实施成本")]),s("a-table",{ref:"table",attrs:{size:"middle",columns:t.columns1,dataSource:[].concat(t.assetData.services),pagination:!1,rowKey:function(t,e){return e}},scopedSlots:t._u([{key:"orderPrice",fn:function(e){return s("span",{},[t._v(t._s(e)+"元")])}}])}),s("a-divider",{attrs:{orientation:"left"}},[t._v("支付方式")]),s("div",{staticClass:"pay-mode"},[s("div",{staticClass:"pay-mode-item",class:1==t.sourceId?"pay-mode-active":"",on:{click:function(e){t.sourceId=1}}},[s("a-icon",{staticStyle:{color:"#1890ff"},attrs:{type:"alipay"}}),t._v("支付宝支付 ")],1),s("div",{staticClass:"pay-mode-item",class:0==t.sourceId?"pay-mode-active":"",on:{click:function(e){t.sourceId=0}}},[s("a-icon",{staticStyle:{color:"#04BE02"},attrs:{type:"wechat"}}),t._v("微信支付 ")],1)]),s("a-row",{staticClass:"mt20",attrs:{type:"flex",justify:"center"}},[s("a-col",[s("a-button",{attrs:{disabled:t.loading},on:{click:t.prevStep}},[t._v("上一步")]),s("a-button",{staticStyle:{"margin-left":"8px"},attrs:{loading:t.loading,type:"primary"},nativeOn:{click:function(e){return e.preventDefault(),t.nextStep.apply(null,arguments)}}},[t.loading?s("span",[t._v("采买创建中...")]):s("span",[t._v("采买创建集群")])])],1)],1)],1)}),[],!1,null,"4eec5b8c",null)),b=g.exports,_=s("d044"),y=s.n(_),S={name:"Step3",props:{payInfo:{type:Object,required:!0}},data:function(){return{loading:!1,expireTime:0}},mounted:function(){this.qrcodeScan(),this.payCallback()},methods:{nextStep:function(){var t=this;this.loading=!0,Object(r.eb)({orderId:this.payInfo.orderId}).then((function(e){var s=e.status,a=e.data;e.msg,1===s?(clearInterval(t.timer),t.$message.success("支付成功"),t.$emit("nextStep",a)):t.$message.warning("订单正在处理中")})).catch((function(e){t.$message.error(e)})).finally((function(){t.loading=!1}))},prevStep:function(){this.$emit("prevStep")},payCallback:function(){var t=this;this.expireTime=(new Date).getTime()+9e5,this.timer=setInterval((function(){(new Date).getTime()>t.expireTime&&(clearInterval(t.timer),t.$message.error("支付有效时间为15分钟，当前支付超时，请重新下单"),t.$emit("finish")),Object(r.eb)({orderId:t.payInfo.orderId}).then((function(e){var s=e.status,a=e.data;e.msg,1===s&&(clearInterval(t.timer),t.$message.success("支付成功"),t.$emit("nextStep",a))})).catch((function(e){t.$message.error(e)}))}),5e3)},qrcodeScan:function(){new y.a("qrcode",{width:200,height:200,text:this.payInfo.codeUrl})}}},x=S,I=(s("9da8"),Object(l.a)(x,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{ref:"qrcode",attrs:{id:"qrcode"}}),s("a-row",{staticClass:"mt20",attrs:{type:"flex",justify:"center"}},[s("a-col",[s("a-button",{attrs:{disabled:t.loading},on:{click:t.prevStep}},[t._v("取消")]),s("a-button",{staticStyle:{"margin-left":"8px"},attrs:{loading:t.loading,type:"primary"},nativeOn:{click:function(e){return e.preventDefault(),t.nextStep.apply(null,arguments)}}},[s("span",[t._v("支付成功")])])],1)],1)],1)}),[],!1,null,"0c17cc97",null)),w=I.exports,C={name:"Step3",data:function(){return{loading:!1}},methods:{finish:function(){this.$emit("finish")}}},k=(s("c2af"),Object(l.a)(C,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("a-form",[s("a-result",{staticStyle:{"max-width":"560px",margin:"40px auto 0"},attrs:{status:"success","is-success":!0,title:"集群创建成功","sub-title":"预计三十分钟内，部署完毕"},scopedSlots:t._u([{key:"extra",fn:function(){return[s("a-button",{attrs:{type:"primary"},on:{click:t.finish}},[t._v("确认")])]},proxy:!0}])})],1)],1)}),[],!1,null,"bafaa12c",null)),D={name:"StepForm",components:{Step1:u,Step2:b,Step3:w,Step4:k.exports},data:function(){return{currentTab:0,form:{},assetData:{},payInfo:{}}},methods:{nextStep:function(t){switch(this.currentTab){case 0:this.form=t.values,this.assetData=t.data,this.currentTab=1;break;case 1:this.payInfo=t,this.currentTab=2;break;default:this.currentTab<3&&(this.currentTab+=1)}},prevStep:function(){this.currentTab>0&&(this.currentTab-=1)},finish:function(){this.$emit("close")}}},T=D,$=(s("b25b"),Object(l.a)(T,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("a-steps",{staticClass:"steps",attrs:{current:t.currentTab}},[s("a-step",{attrs:{title:"集群信息"}}),s("a-step",{attrs:{title:"规划方案"}}),s("a-step",{attrs:{title:"确认支付"}}),s("a-step",{attrs:{title:"完成"}})],1),s("div",{staticClass:"content"},[s("step1",t._b({directives:[{name:"show",rawName:"v-show",value:0===t.currentTab,expression:"currentTab === 0"}],ref:"createForm",on:{nextStep:t.nextStep}},"step1",t.$attrs,!1)),1===t.currentTab?s("step2",{attrs:{form:t.form,assetData:t.assetData},on:{nextStep:t.nextStep,prevStep:t.prevStep}}):t._e(),2===t.currentTab?s("step3",{attrs:{payInfo:t.payInfo},on:{nextStep:t.nextStep,prevStep:t.prevStep}}):t._e(),3===t.currentTab?s("step4",{on:{prevStep:t.prevStep,finish:t.finish}}):t._e()],1)],1)}),[],!1,null,"3377258c",null)),j=$.exports,L=s("2909"),O=(s("a9e3"),s("99af"),s("d81d"),s("b64b"),s("a434"),s("c740"),[{title:"配置名称",className:"mw120",dataIndex:"clusterConfigTitle"},{title:"配置信息",className:"w300",dataIndex:"clusterConfigInfo",scopedSlots:{customRender:"clusterConfigInfo"}},{title:"配置时间",className:"mw120",dataIndex:"clusterConfigCreatetime"}]),F={mixins:[d.a],props:{clusterId:{type:Number,required:!0}},name:"detail",data:function(){return{columns:O,clusterInfo:{},deploylist:[],listLoading:!1,treeData:[],types:1,unfoldArr:[]}},methods:{getClusterInfo:function(){var t=this;Object(r.y)({cid:this.clusterId}).then((function(e){var s=e.status,r=e.data,n=e.msg;1===s?(t.clusterInfo=Object(a.a)({},r),t.treeData=t.treeParse(r.servicesLists)):t.$message.error(n)})).catch((function(t){})),this.readClusterMessage()},readClusterMessage:function(){var t=this;this.listLoading=!0,Object(r.gb)({clusterId:this.clusterId,types:this.types}).then((function(e){var s=e.status,a=e.data,r=e.msg;1===s?(t.deploylist=Boolean(t.types)?a||[]:[].concat(Object(L.a)(t.deploylist),Object(L.a)(a)),t.listLoading=!1):(t.listLoading=!1,t.$message.error(r))})).catch((function(t){}))},treeParse:function(t){return Object.keys(t).map((function(e){return{title:e,children:t[e].map((function(t){return{title:t}}))}}))},switchTypes:function(){this.types=1==this.types?0:1,this.readClusterMessage()},unfold:function(t){this.unfoldArr=[].concat(Object(L.a)(this.unfoldArr),[t])},fold:function(t){this.unfoldArr.splice(this.unfoldArr.findIndex((function(e){return e==t})),1)}},created:function(){this.getClusterInfo()}},N=F,M=(s("76e2"),Object(l.a)(N,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("a-divider",{attrs:{orientation:"left"}},[t._v("基础信息")]),s("a-descriptions",{attrs:{size:"small",column:t.isMobile?1:2,layout:"vertical",bordered:""}},[s("a-descriptions-item",{attrs:{label:"集群别名"}},[t._v(t._s(t.clusterInfo.clusterName||"无"))]),s("a-descriptions-item",{attrs:{label:"集群ID"}},[t._v(t._s(t.clusterInfo.clusterId||"无"))]),s("a-descriptions-item",{attrs:{label:"创建时间"}},[t._v(t._s(t.clusterInfo.clusterCreatetime||"无"))]),s("a-descriptions-item",{attrs:{label:"最后更新时间"}},[t._v(t._s(t.clusterInfo.clusterUpdatetime||"无"))])],1),s("a-divider",{staticClass:"relative",attrs:{orientation:"left"}},[t._v(" 集群配置服务 "),s("div",{staticClass:"deploySwitch"},[s("div",{class:1==t.types?"text-blue":""},[t._v("普通用户")]),s("a-switch",{staticClass:"mx10",attrs:{checked:!Boolean(t.types)},on:{change:t.switchTypes}}),s("div",{class:0==t.types?"text-blue":""},[t._v("技术专家")])],1)]),s("a-table",{ref:"table",attrs:{size:"middle",columns:t.columns,dataSource:t.deploylist,loading:t.listLoading,pagination:!1,rowKey:function(t,e){return e}},scopedSlots:t._u([{key:"clusterConfigInfo",fn:function(e,a){return s("span",{},[e.length>60&&!t.unfoldArr.includes(a.id)?s("span",{},[t._v(" "+t._s(e.substring(0,60))+" "),s("span",{staticClass:"text-blue cursor-pointer",on:{click:function(e){return t.unfold(a.id)}}},[s("a-icon",{staticClass:"mr5",attrs:{type:"down"}}),t._v("展开全部 ")],1)]):t._e(),e.length>60&&t.unfoldArr.includes(a.id)?s("span",{},[t._v(" "+t._s(e)+" "),s("span",{staticClass:"text-blue cursor-pointer",on:{click:function(e){return t.fold(a.id)}}},[s("a-icon",{staticClass:"mr5",attrs:{type:"down"}}),t._v("收起全部 ")],1)]):t._e(),e.length<=60?s("span",[t._v(t._s(e||"无"))]):t._e()])}}])}),s("a-divider",{attrs:{orientation:"left"}},[t._v("集群服务")]),s("a-tree",{attrs:{"tree-data":t.treeData,autoExpandParent:"",showLine:""}})],1)}),[],!1,null,"e639dc64",null)),A=M.exports,R=[{title:"资源名称",className:"mw120",dataIndex:"clusterAssetsName"},{title:"资源规格",className:"mw120",dataIndex:"clusterAssetsSpecification"},{title:"资源单价",className:"mw90",dataIndex:"clusterAssetsMoney",scopedSlots:{customRender:"clusterAssetsMoney"}},{title:"资源数量",className:"mw90",dataIndex:"clusterAssetsQuantity",scopedSlots:{customRender:"clusterAssetsQuantity"}},{title:"资源备注",className:"mw90",dataIndex:"clusterAssetsRemark",scopedSlots:{customRender:"clusterAssetsRemark"}}],q={0:{status:"processing",text:"初始化(搭建)"},1:{status:"processing",text:"待决策"},2:{status:"processing",text:"配置部署中"},3:{status:"success",text:"运行中"},4:{status:"error",text:"异常"},5:{status:"default",text:"停用"},6:{status:"warning",text:"回收中"}},z={mixins:[d.a],props:{clusterId:{type:Number,required:!0}},filters:{statusFilter:function(t){return q[t].text},statusTypeFilter:function(t){return q[t].status}},data:function(){return this.columns=R,{clusterInfo:{},Assetslist:[],listLoading:!1}},methods:{getClusterInfo:function(){var t=this;this.listLoading=!0,Object(r.y)({cid:this.clusterId}).then((function(e){var s=e.status,n=e.data,i=e.msg;return 1===s?t.clusterInfo=Object(a.a)({},n):t.$message.error(i),Object(r.x)({clusterId:t.clusterId})})).then((function(e){var s=e.status,a=e.data,r=e.msg;1===s?(t.Assetslist=a||[],t.listLoading=!1):(t.listLoading=!1,t.$message.error(r))})).catch((function(e){t.listLoading=!1}))}},created:function(){this.getClusterInfo()}},E=z,P=Object(l.a)(E,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("a-divider",{attrs:{orientation:"left"}},[t._v("基础信息")]),s("a-descriptions",{attrs:{size:"small",column:t.isMobile?1:3,layout:"vertical",bordered:""}},[s("a-descriptions-item",{attrs:{label:"集群规模"}},[t._v(t._s(t.clusterInfo.clusterAmounts||"无"))]),s("a-descriptions-item",{attrs:{label:"状态"}},[t.clusterInfo.clusterServiceStatus?s("span",[s("a-badge",{attrs:{status:t._f("statusTypeFilter")(t.clusterInfo.clusterServiceStatus),text:t._f("statusFilter")(t.clusterInfo.clusterServiceStatus)}})],1):t._e()]),s("a-descriptions-item",{attrs:{label:"归属云"}},[t._v(t._s(t.clusterInfo.clusterCloudId||"无"))]),s("a-descriptions-item",{attrs:{label:"更新时间"}},[t._v(t._s(t.clusterInfo.clusterUpdatetime||"无"))]),s("a-descriptions-item",{attrs:{label:"创建时间"}},[t._v(t._s(t.clusterInfo.clusterCreatetime||"无"))])],1),s("a-divider",{attrs:{orientation:"left"}},[t._v("资源计算")]),s("a-table",{ref:"table",attrs:{size:"middle",columns:t.columns,dataSource:t.Assetslist,loading:t.listLoading,pagination:!1,rowKey:function(t,e){return e}},scopedSlots:t._u([{key:"clusterAssetsMoney",fn:function(e){return s("span",{},[t._v(t._s(e)+"/元")])}},{key:"clusterAssetsQuantity",fn:function(e){return s("span",{},[t._v(t._s(e)+"/个")])}},{key:"clusterAssetsRemark",fn:function(e){return s("span",{},[t._v(t._s(e||"无"))])}}])})],1)}),[],!1,null,null,null),U=P.exports,V=(s("7db0"),{0:{status:"processing",text:"初始化(搭建)"},1:{status:"processing",text:"待决策"},2:{status:"processing",text:"配置部署中"},3:{status:"success",text:"运行中"},4:{status:"error",text:"异常"},5:{status:"default",text:"停用"},6:{status:"warning",text:"回收中"}}),B={mixins:[d.a],props:{clusterId:{type:Number,required:!0}},name:"detail",data:function(){return{clusterInfo:{},progress:[],progressStatusList:[{color:"blue",label:"待执行",icon:"clock-circle"},{color:"blue",label:"执行中",icon:"sync"},{color:"green",label:"成功",icon:"check-circle"},{color:"red",label:"失败",icon:"close-circle"},{color:"green",label:"完成",icon:"check-circle"},{color:"orange",label:"异常",icon:"warning"},{color:"cyan",label:"跳过",icon:"issues-close"}],progressLStatus:!1,timer:null}},filters:{statusFilter:function(t){return V[t].text},statusTypeFilter:function(t){return V[t].status},formatSeconds:function(t){var e=parseInt(t),s=Math.floor(e/3600)<10?"0"+Math.floor(e/3600):Math.floor(e/3600),a=Math.floor(e/60%60)<10?"0"+Math.floor(e/60%60):Math.floor(e/60%60),r=Math.floor(e%60)<10?"0"+Math.floor(e%60):Math.floor(e%60),n="";return"00"!==s&&(n+="".concat(s,"小时")),"00"!==a&&(n+="".concat(a,"分")),n+="".concat(r,"秒")}},methods:{getClusterInfo:function(){var t=this;this.listLoading=!0,Object(r.y)({cid:this.clusterId}).then((function(e){var s=e.status,r=e.data,n=e.msg;1===s?t.clusterInfo=Object(a.a)({},r):t.$message.error(n)})).catch((function(t){}))},getDeployStages:function(){var t=this;Object(r.B)({cid:this.clusterId}).then((function(e){var s=e.status,a=e.data,r=e.msg;1===s?(a.clusterStages.length>0&&(t.progressLStatus=!0),a.clusterStages.every((function(t){return t.stageStatus>1}))&&t.timer&&(clearInterval(t.timer),t.timer=null),t.progress=a.clusterStages||[],!a.find((function(t){return t.stageStatus<2}))&&t.timer&&clearInterval(t.timer)):t.$message.error(r)})).catch((function(t){}))}},created:function(){this.getClusterInfo()},mounted:function(){var t=this;this.timer&&(clearInterval(this.timer),this.timer=null),this.timer=setInterval((function(){t.getDeployStages()}),1500)},beforeCreate:function(){},beforeMount:function(){},beforeUpdate:function(){},updated:function(){},beforeDestroy:function(){null!=this.timer&&(clearInterval(this.timer),this.timer=null)},destroyed:function(){}},H=B,J=(s("ffc6"),Object(l.a)(H,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("a-divider",{attrs:{orientation:"left"}},[t._v("集群信息")]),s("a-descriptions",{attrs:{size:"small",column:t.isMobile?1:3,bordered:""}},[s("a-descriptions-item",{attrs:{label:"集群规模"}},[t._v(t._s("≈"+t.clusterInfo.clusterCurrent+"人同时在线"||!1))]),s("a-descriptions-item",{attrs:{label:"状态"}},[t.clusterInfo.clusterServiceStatus?s("span",[s("a-badge",{attrs:{status:t._f("statusTypeFilter")(t.clusterInfo.clusterServiceStatus),text:t._f("statusFilter")(t.clusterInfo.clusterServiceStatus)}})],1):t._e()]),s("a-descriptions-item",{attrs:{label:"归属云"}},[t._v(t._s(t.clusterInfo.clusterCloudId||"无"))]),s("a-descriptions-item",{attrs:{label:"更新时间"}},[t._v(t._s(t.clusterInfo.clusterUpdatetime||"无"))]),s("a-descriptions-item",{attrs:{label:"创建时间"}},[t._v(t._s(t.clusterInfo.clusterCreatetime||"无"))])],1),s("a-divider",{attrs:{orientation:"left"}},[t._v("部署进度")]),t.progressLStatus?s("div",[t.progress.length!=t.progress.reduce((function(t,e){return t+Number(e.stageStatus>1?1:0)}),0)?s("a-progress",{attrs:{percent:100*(t.progress.reduce((function(t,e){return t+Number(e.stageStatus>1?1:0)}),0)/t.progress.length).toFixed(4),status:"active"}}):t._e(),t.progress.every((function(t){return 2==t.stageStatus}))?s("a-progress",{attrs:{percent:100}}):t._e(),t.progress.every((function(t){return t.stageStatus>1}))&&t.progress.reduce((function(t,e){return t+Number(e.stageStatus>2?1:0)}),0)>1?s("a-progress",{attrs:{percent:100*(t.progress.reduce((function(t,e){return t+Number(e.stageStatus>1?1:0)}),0)/t.progress.length).toFixed(4),status:"exception"}}):t._e()],1):s("div",[s("a-progress",{attrs:{percent:0,status:"active"}})],1),s("a-divider",{attrs:{orientation:"left"}},[t._v("部署阶段")]),t.progressLStatus?s("a-timeline",{attrs:{mode:"left"}},t._l(t.progress,(function(e,a){return s("a-timeline-item",{key:a,attrs:{color:t.progressStatusList[e.stageStatus].color}},[s("a-icon",{staticStyle:{"font-size":"16px"},attrs:{slot:"dot",type:t.progressStatusList[e.stageStatus].icon,spin:"sync"==t.progressStatusList[e.stageStatus].icon},slot:"dot"}),s("h4",[t._v(" "+t._s(e.stageName)+" "),s("a-tag",{attrs:{size:"small",color:t.progressStatusList[e.stageStatus].color}},[t._v(t._s(t.progressStatusList[e.stageStatus].label))])],1),s("p",{staticClass:"timeline-item-createtime"},[t._v(t._s(e.stageCreatetime))]),e.stageStatus>1&&e.stageCreatetime?s("p",[t._v("耗时 "+t._s(t._f("formatSeconds")(new Date(e.stageUpdatetime).getTime()/1e3-new Date(e.stageCreatetime).getTime()/1e3||1)))]):t._e()],1)})),1):s("div",{staticClass:"example"},[s("a-spin",{attrs:{tip:"部署阶段正在加载中..."}})],1)],1)}),[],!1,null,"904a5b3e",null)),K=J.exports,Q=[{title:"实例ID",className:"mw120",dataIndex:"clusterInstanceId",scopedSlots:{customRender:"ID"}},{title:"状态",className:"mw90",dataIndex:"clusterServiceStatus",scopedSlots:{customRender:"status"}},{title:"归属",className:"mw150",dataIndex:"clusterRegionId",scopedSlots:{customRender:"region"}},{title:"创建时间",className:"mw90",dataIndex:"clusterCreatetime"},{title:"更新时间",className:"mw90",dataIndex:"clusterUpdatetime",scopedSlots:{customRender:"updateTime"}},{title:"付费类型",className:"mw90",dataIndex:"clusterType"},{title:"操作",dataIndex:"action",align:"center",width:"150px",scopedSlots:{customRender:"action"}}],W={0:{value:0,status:"processing",text:"初始化(搭建)"},1:{value:1,status:"processing",text:"待决策"},2:{value:2,status:"processing",text:"配置部署中"},3:{value:3,status:"success",text:"运行中"},4:{value:4,status:"error",text:"异常"},5:{value:5,status:"default",text:"停用"},6:{value:6,status:"warning",text:"回收中"}},Y={mixins:[n.a],components:{CreateStep:j,DetailFrom:A,JumpDetail:U,ReadDetail:K},data:function(){return{advanced:!1,searchForm:{clusterInstanceId:void 0,clusterCloudId:void 0},pagination:{current:1,pageSize:10,total:0,showQuickJumper:!0,hideOnSinglePage:!0,showTotal:function(t){return"共 ".concat(t," 条数据")}},list:[],statusMap:W,columns:Q,cloudList:[],regionList:[],listLoading:!1,loading:!1,createDrawer:!1,detailDrawer:!1,jumpDrawer:!1,readDrawer:!1,clusterId:""}},filters:{statusFilter:function(t){return W[t].text},statusTypeFilter:function(t){return W[t].status}},methods:{search:function(){this.pagination.current=1,this.getList()},tableChange:function(t){this.pagination=t,this.getList()},getList:function(){var t=this;this.listLoading=!0;var e=this.pagination,s=e.current,n=e.pageSize;Object(r.d)(Object(a.a)(Object(a.a)({},{page:s,pageSize:n}),this.searchForm)).then((function(e){var s=e.status,a=e.data,r=e.msg;if(1===s){var n=a.page,i=a.pageSize,o=a.total,c=a.list;t.list=c||[],t.pagination={current:n,pageSize:i,total:o}}else t.$message.error(r);t.listLoading=!1})).catch((function(e){t.listLoading=!1}))},judgmentCluster:function(){var t=this,e=this;this.$destroyAll(),Object(r.Y)().then((function(s){var a=s.status;s.data,s.msg,1!=a&&t.$confirm({title:"提示",content:"当前暂未创建集群",okText:"去绑定",maskClosable:!0,onOk:function(){return e.create(),new Promise((function(t,e){t()})).catch((function(){}))},onCancel:function(){}})})).catch((function(t){}))},create:function(){this.createDrawer=!0,this.getCloudList()},getCloudList:function(){var t=this;Object(r.t)().then((function(e){var s=e.status,a=e.data,r=e.msg;1===s?t.cloudList=a||[]:t.$message.error(r)})).catch((function(){}))},goJumpDetails:function(t){this.clusterId=t,this.jumpDrawer=!0},submitPurchase:function(t){var e=this;Object(r.q)({cid:t}).then((function(t){var s=t.status;t.data,t.msg,1===s?(e.jumpDrawer=!1,e.$message.success("提交后台部署成功，正在帮您创建！")):e.$message.error("执行部署有问题，请稍后再试!")}))},goDetaulsRead:function(t){this.clusterId=t,this.readDrawer=!0},goDetails:function(t){this.clusterId=t,this.detailDrawer=!0},recycle:function(t){var e=this;this.$confirm({title:"提示",content:"此操作将执行集群回收, 是否继续?",okText:"确定",maskClosable:!0,onOk:function(){return Object(r.hb)({cid:t}).then((function(t){var s=t.status,a=(t.data,t.msg);1===s?e.$message.success(a):e.$message.error(a)})),new Promise((function(t,e){t()})).catch((function(){}))},onCancel:function(){}})},hint:function(){this.$warning({title:"提示",content:"集群异常，请联系工作人员。",maskClosable:!0})},toggleAdvanced:function(){this.advanced=!this.advanced},close:function(){this.pagination.current=1,this.getList(),this.createDrawer=!1}},created:function(){this.getList(),this.getCloudList(),this.judgmentCluster()},mounted:function(){},beforeCreate:function(){},beforeMount:function(){},beforeUpdate:function(){},updated:function(){},beforeDestroy:function(){},destroyed:function(){},activated:function(){}},G=Y,X=Object(l.a)(G,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("a-card",{attrs:{bordered:!1}},[s("a-form",{directives:[{name:"show",rawName:"v-show",value:t.showSearch,expression:"showSearch"}],staticClass:"mb20",attrs:{layout:"inline"},model:{value:t.searchForm,callback:function(e){t.searchForm=e},expression:"searchForm"}},[s("a-form-item",{attrs:{label:"集群实例ID"}},[s("a-input",{attrs:{placeholder:"集群实例ID"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.search.apply(null,arguments)}},model:{value:t.searchForm.clusterInstanceId,callback:function(e){t.$set(t.searchForm,"clusterInstanceId",e)},expression:"searchForm.clusterInstanceId"}})],1),s("a-form-item",{attrs:{label:"归属云"}},[s("a-select",{staticClass:"mw180",attrs:{placeholder:"请选择归属云"},on:{change:t.search},model:{value:t.searchForm.clusterCloudId,callback:function(e){t.$set(t.searchForm,"clusterCloudId",e)},expression:"searchForm.clusterCloudId"}},t._l(t.cloudList,(function(e){return s("a-select-option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.label))])})),1)],1),s("a-form-item",{attrs:{label:"集群状态"}},[s("a-select",{staticClass:"mw180",attrs:{placeholder:"请选择集群状态"},on:{change:t.search},model:{value:t.searchForm.clusterServiceStatus,callback:function(e){t.$set(t.searchForm,"clusterServiceStatus",e)},expression:"searchForm.clusterServiceStatus"}},t._l(t.statusMap,(function(e){return s("a-select-option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.text))])})),1)],1),s("a-form-item",[s("a-button",{attrs:{type:"primary"},nativeOn:{click:function(e){return e.preventDefault(),t.search.apply(null,arguments)}}},[t._v("查询")]),s("a-button",{staticStyle:{"margin-left":"8px"},on:{click:function(){return t.searchForm={}}}},[t._v("重置")])],1)],1),s("a-row",{attrs:{gutter:10,type:"flex",justify:"space-between"}},[s("a-col",{attrs:{span:12}},[s("a-button",{attrs:{type:"primary",icon:"plus",ghost:""},on:{click:t.create}},[t._v("创建")])],1),s("a-col",{attrs:{span:2}},[s("right-toolbar",{attrs:{showSearch:t.showSearch},on:{"update:showSearch":function(e){t.showSearch=e},"update:show-search":function(e){t.showSearch=e},queryTable:t.getList}})],1)],1),s("div",{staticClass:"table-operator"}),s("a-table",{ref:"table",attrs:{size:"middle",columns:t.columns,dataSource:t.list,pagination:t.pagination,loading:t.listLoading,rowKey:function(t,e){return e}},on:{change:t.tableChange},scopedSlots:t._u([{key:"ID",fn:function(e){return s("span",{},[t._v(t._s(e||"待初始化"))])}},{key:"status",fn:function(e){return s("span",{},[s("a-badge",{attrs:{status:t._f("statusTypeFilter")(e),text:t._f("statusFilter")(e)}})],1)}},{key:"region",fn:function(e,a){return s("span",{},[t._v(t._s(a.clusterCloudId)+"/"+t._s(a.clusterRegionId))])}},{key:"updateTime",fn:function(e){return s("span",{},[s("span",[t._v(t._s(e||"无"))])])}},{key:"action",fn:function(e,a){return s("span",{},[[0==a.clusterServiceStatus||7==a.clusterServiceStatus||8==a.clusterServiceStatus?s("a-button",{attrs:{type:"link",disabled:""}},[t._v("查看")]):t._e(),a.clusterServiceStatus>1&&a.clusterServiceStatus<3||4==a.clusterServiceStatus?s("a",{on:{click:function(e){return t.goDetaulsRead(a.clusterId)}}},[t._v("查看")]):t._e(),3==a.clusterServiceStatus?s("a",{on:{click:function(e){return t.goDetails(a.clusterId)}}},[t._v("查看")]):t._e()]],2)}}])})],1),s("a-drawer",{attrs:{title:"创建集群",width:700,visible:t.createDrawer,"body-style":{"padding-top":"18px",paddingBottom:"80px"}},on:{"update:visible":function(e){t.createDrawer=e},close:t.close}},[t.createDrawer?s("create-step",{ref:"createForm",attrs:{cloudList:t.cloudList},on:{close:t.close}}):t._e()],1),s("a-drawer",{attrs:{title:"集群详情",width:600,visible:t.detailDrawer,"body-style":{"padding-top":"0px"}},on:{"update:visible":function(e){t.detailDrawer=e},close:function(){t.detailDrawer=!1,t.loading=!1}}},[t.detailDrawer?s("detail-from",{attrs:{clusterId:t.clusterId}}):t._e()],1),s("a-drawer",{attrs:{title:"查看集群",width:800,visible:t.readDrawer,"body-style":{"padding-top":"0px"}},on:{"update:visible":function(e){t.readDrawer=e},close:function(){t.readDrawer=!1,t.loading=!1}}},[t.readDrawer?s("read-detail",{attrs:{clusterId:t.clusterId}}):t._e()],1)],1)}),[],!1,null,null,null);e.default=X.exports},"3d73":function(t,e,s){"use strict";var a=(s("caad"),s("2532"),{name:"RightToolbar",data:function(){return{value:[],title:"显示/隐藏",open:!1,spin:!1}},props:{showSearch:{type:Boolean,default:!0},columns:{type:Array}},created:function(){for(var t in this.columns)!1===this.columns[t].visible&&this.value.push(parseInt(t))},methods:{toggleSearch:function(){this.$emit("update:showSearch",!this.showSearch)},refresh:function(){this.$emit("queryTable")},dataChange:function(t){for(var e in this.columns){var s=this.columns[e].key;this.columns[e].visible=!t.includes(s)}},showColumn:function(){this.open=!0}}}),r=a,n=(s("668e"),s("2877")),i=Object(n.a)(r,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"top-right-btn"},[s("a-row",{attrs:{type:"flex",justify:"end"}},[s("a-button-group",[s("a-tooltip",{staticClass:"item",attrs:{title:t.showSearch?"隐藏搜索":"显示搜索",placement:"top"}},[s("a-button",{attrs:{shape:"circle",icon:"search"},on:{click:function(e){return t.toggleSearch()}}})],1),s("a-tooltip",{staticClass:"item",attrs:{title:"刷新",placement:"top"}},[s("a-button",{attrs:{shape:"circle",icon:"sync"},on:{click:function(e){return t.refresh()}}})],1)],1)],1)],1)}),[],!1,null,"84deea80",null),o=i.exports;e.a={components:{RightToolbar:o},data:function(){return{showSearch:!1}},methods:{search:function(){this.pagination.current=1,this.getList()}}}},"432b":function(t,e,s){"use strict";s.d(e,"a",(function(){return n}));var a=s("5530"),r=s("2f62"),n={computed:Object(a.a)(Object(a.a)({},Object(r.d)({layout:function(t){return t.app.layout},navTheme:function(t){return t.app.theme},primaryColor:function(t){return t.app.color},colorWeak:function(t){return t.app.weak},fixedHeader:function(t){return t.app.fixedHeader},fixedSidebar:function(t){return t.app.fixedSidebar},contentWidth:function(t){return t.app.contentWidth},autoHideHeader:function(t){return t.app.autoHideHeader},isMobile:function(t){return t.app.isMobile},sideCollapsed:function(t){return t.app.sideCollapsed},multiTab:function(t){return t.app.multiTab}})),{},{isTopMenu:function(){return"topmenu"===this.layout}}),methods:{isSideMenu:function(){return!this.isTopMenu}}}},"668e":function(t,e,s){"use strict";s("c885")},7203:function(t,e,s){},"76e2":function(t,e,s){"use strict";s("7203")},"81e91":function(t,e,s){"use strict";s("1bb3")},"9aa5":function(t,e,s){"use strict";s("c972")},"9d26":function(t,e,s){},"9da8":function(t,e,s){"use strict";s("9d26")},b25b:function(t,e,s){"use strict";s("2348")},c2af:function(t,e,s){"use strict";s("3157")},c885:function(t,e,s){},c972:function(t,e,s){},f5ca:function(t,e,s){},ffc6:function(t,e,s){"use strict";s("f5ca")}}]);